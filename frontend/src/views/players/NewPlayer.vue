<template>
  <div class="player-new min-h-screen bg-gray-50 py-6">
    <div class="container mx-auto px-4">
      <!-- –®–∞–ø–∫–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏ –∫–Ω–æ–ø–∫–∞–º–∏ -->
      <div class="bg-white rounded-xl shadow-md mb-8 overflow-hidden">
        <div class="px-6 py-5 flex flex-col md:flex-row justify-between items-center bg-gradient-to-r from-blue-500 to-indigo-600 text-white">
          <div>
            <h1 class="text-2xl font-bold">–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞</h1>
            <p class="text-blue-100 mt-1">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–æ–≤–æ–º –∏–≥—Ä–æ–∫–µ</p>
          </div>
          <div class="flex space-x-3 mt-4 md:mt-0">
            <button 
              @click="$router.push('/players')" 
              class="px-4 py-2 bg-white/20 backdrop-blur-sm rounded-lg text-white hover:bg-white/30 transition-all duration-200"
            >
              –û—Ç–º–µ–Ω–∞
            </button>
            <button 
              @click="createPlayer" 
              class="px-6 py-2 bg-white rounded-lg text-blue-600 hover:bg-blue-50 transition-all duration-200 font-medium"
            >
              –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
            </button>
          </div>
        </div>
        
        <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —à–∞–≥–æ–≤ -->
        <div class="px-6 py-4 border-b border-gray-100">
          <div class="flex justify-between mb-2">
            <div class="text-sm text-gray-500">–ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è</div>
            <div class="text-sm font-medium text-blue-600">–®–∞–≥ {{ currentStep }} –∏–∑ {{ totalSteps }}</div>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-2.5">
            <div class="bg-blue-600 h-2.5 rounded-full transition-all duration-300" :style="{ width: `${(currentStep / totalSteps) * 100}%` }"></div>
          </div>
          <div class="flex justify-between mt-4 overflow-x-auto pb-1 hide-scrollbar">
            <button 
              v-for="step in steps" 
              :key="step.id"
              @click="currentStep = step.id"
              class="px-4 py-2 rounded-lg text-sm whitespace-nowrap transition-all duration-200"
              :class="currentStep === step.id ? 'bg-blue-100 text-blue-700 font-medium' : 'text-gray-500 hover:text-blue-600'"
            >
              {{ step.title }}
            </button>
          </div>
        </div>
      </div>
      
      <!-- –®–∞–≥ 1: –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
      <div v-if="currentStep === 1" class="space-y-6 transition-all duration-300">
        <div class="bg-white rounded-xl shadow-sm overflow-hidden">
          <div class="p-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-6">–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
              <div class="form-group">
                <label class="block text-sm font-medium text-gray-700 mb-2">–ò–º—è</label>
                <input 
                  v-model="player.first_name" 
                  type="text" 
                  class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
                  placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è"
                />
              </div>
              
              <div class="form-group">
                <label class="block text-sm font-medium text-gray-700 mb-2">–§–∞–º–∏–ª–∏—è</label>
                <input 
                  v-model="player.last_name" 
                  type="text" 
                  class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
                  placeholder="–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é"
                />
              </div>
              
              <div class="form-group">
                <label class="block text-sm font-medium text-gray-700 mb-2">–û—Ç—á–µ—Å—Ç–≤–æ</label>
                <input 
                  v-model="player.middle_name" 
                  type="text" 
                  class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
                  placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Ç—á–µ—Å—Ç–≤–æ"
                />
              </div>
            </div>
            
            <div class="mt-6">
              <label class="block text-sm font-medium text-gray-700 mb-2">–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</label>
              <textarea 
                v-model="player.health_notes" 
                rows="4" 
                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
                placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è"
              ></textarea>
            </div>
          </div>
        </div>
        
        <div class="flex justify-end">
          <button 
            @click="nextStep" 
            class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all duration-200 flex items-center"
          >
            –î–∞–ª–µ–µ
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M12.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" />
            </svg>
          </button>
        </div>
      </div>
      
      <!-- –®–∞–≥ 2: –ù–∏–∫–Ω–µ–π–º—ã –∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã -->
      <div v-if="currentStep === 2" class="space-y-6 transition-all duration-300">
        <div class="bg-white rounded-xl shadow-sm overflow-hidden">
          <div class="p-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-6">–ù–∏–∫–Ω–µ–π–º—ã</h2>
            
            <div class="form-group">
              <div class="flex flex-col md:flex-row gap-4">
                <div class="w-full md:w-1/2">
                  <label class="block text-sm font-medium text-gray-700 mb-2">–ù–∏–∫–Ω–µ–π–º</label>
                  <input 
                    v-model="nickname.nickname" 
                    type="text" 
                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
                    placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫–Ω–µ–π–º"
                  />
                </div>
                
                <div class="w-full md:w-1/2">
                  <label class="block text-sm font-medium text-gray-700 mb-2">–ü–æ–∫–µ—Ä-—Ä—É–º</label>
                  <input 
                    v-model="nickname.room" 
                    type="text" 
                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
                    placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–æ–∫–µ—Ä-—Ä—É–º–∞"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="bg-white rounded-xl shadow-sm overflow-hidden">
          <div class="p-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-6">–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
            
            <div class="mb-6">
              <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
              <div class="flex">
                <span class="inline-flex items-center px-3 rounded-l-lg border border-r-0 border-gray-300 bg-gray-50 text-gray-500">
                  ‚úâÔ∏è
                </span>
                <input 
                  v-model="email" 
                  type="email" 
                  class="w-full p-3 border border-gray-300 rounded-r-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
                  placeholder="username@example.com"
                />
              </div>
            </div>
            
            <div class="mb-6">
              <label class="block text-sm font-medium text-gray-700 mb-2">–¢–µ–ª–µ—Ñ–æ–Ω</label>
              <div class="flex">
                <span class="inline-flex items-center px-3 rounded-l-lg border border-r-0 border-gray-300 bg-gray-50 text-gray-500">
                  üì±
                </span>
                <input 
                  v-model="phone.value" 
                  type="text" 
                  class="flex-1 p-3 border border-gray-300 rounded-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
                  placeholder="+7 (XXX) XXX-XX-XX"
                />
                <input 
                  v-model="phone.description" 
                  type="text" 
                  class="w-1/3 p-3 border border-l-0 border-gray-300 rounded-r-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
                  placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, '–ú–æ–±–∏–ª—å–Ω—ã–π'"
                />
              </div>
            </div>
          </div>
        </div>
        
        <div class="flex justify-between">
          <button 
            @click="prevStep" 
            class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all duration-200 flex items-center"
          >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M7.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l2.293 2.293a1 1 0 010 1.414z" clip-rule="evenodd" />
            </svg>
            –ù–∞–∑–∞–¥
          </button>
          <button 
            @click="nextStep" 
            class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all duration-200 flex items-center"
          >
            –î–∞–ª–µ–µ
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M12.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" />
            </svg>
          </button>
        </div>
      </div>
      
      <!-- –®–∞–≥ 3: –ê–¥—Ä–µ—Å -->
      <div v-if="currentStep === 3" class="space-y-6 transition-all duration-300">
        <div class="bg-white rounded-xl shadow-sm overflow-hidden">
          <div class="p-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-6">–ê–¥—Ä–µ—Å</h2>
            
            <div class="form-group mb-6">
              <label class="block text-sm font-medium text-gray-700 mb-2">–ü–æ–ª–Ω—ã–π –∞–¥—Ä–µ—Å</label>
              <textarea 
                v-model="location.address" 
                rows="2" 
                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
                placeholder="–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å (—É–ª–∏—Ü–∞, –¥–æ–º, –∫–≤–∞—Ä—Ç–∏—Ä–∞)"
              ></textarea>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
              <div class="form-group">
                <label class="block text-sm font-medium text-gray-700 mb-2">–ì–æ—Ä–æ–¥</label>
                <input 
                  v-model="location.city" 
                  type="text" 
                  class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
                  placeholder="–ì–æ—Ä–æ–¥"
                />
              </div>
              
              <div class="form-group">
                <label class="block text-sm font-medium text-gray-700 mb-2">–°—Ç—Ä–∞–Ω–∞</label>
                <input 
                  v-model="location.country" 
                  type="text" 
                  class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
                  placeholder="–°—Ç—Ä–∞–Ω–∞"
                />
              </div>
              
              <div class="form-group">
                <label class="block text-sm font-medium text-gray-700 mb-2">–ü–æ—á—Ç–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å</label>
                <input 
                  v-model="location.postal_code" 
                  type="text" 
                  class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
                  placeholder="–ü–æ—á—Ç–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å"
                />
              </div>
            </div>
          </div>
        </div>
        
        <div class="flex justify-between">
          <button 
            @click="prevStep" 
            class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all duration-200 flex items-center"
          >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M7.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l2.293 2.293a1 1 0 010 1.414z" clip-rule="evenodd" />
            </svg>
            –ù–∞–∑–∞–¥
          </button>
          <button 
            @click="nextStep" 
            class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all duration-200 flex items-center"
          >
            –î–∞–ª–µ–µ
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M12.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" />
            </svg>
          </button>
        </div>
      </div>
      
      <!-- –®–∞–≥ 4: –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏ –∏ –º–µ—Ç–æ–¥—ã –æ–ø–ª–∞—Ç—ã -->
      <div v-if="currentStep === 4" class="space-y-6 transition-all duration-300">
        <div class="bg-white rounded-xl shadow-sm overflow-hidden">
          <div class="p-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-6">–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏</h2>
            
            <div class="form-group mb-4">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞</label>
                  <div class="relative">
                    <select 
                      v-model="socialMedia.platform" 
                      class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all appearance-none pr-10"
                    >
                      <option value="" disabled>–í—ã–±–µ—Ä–∏—Ç–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É</option>
                      <option value="telegram">Telegram</option>
                      <option value="whatsapp">WhatsApp</option>
                      <option value="instagram">Instagram</option>
                      <option value="facebook">Facebook</option>
                      <option value="vk">VK</option>
                      <option value="other">–î—Ä—É–≥–æ–µ</option>
                    </select>
                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                      <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                      </svg>
                    </div>
                  </div>
                </div>
                
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                  <input 
                    v-model="socialMedia.username" 
                    type="text" 
                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
                    placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
                  />
                </div>
              </div>
            </div>
            
            <div class="form-group mb-4">
              <label class="block text-sm font-medium text-gray-700 mb-2">URL</label>
              <div class="flex">
                <span class="inline-flex items-center px-3 rounded-l-lg border border-r-0 border-gray-300 bg-gray-50 text-gray-500">
                  üîó
                </span>
                <input 
                  v-model="socialMedia.url" 
                  type="text" 
                  class="w-full p-3 border border-gray-300 rounded-r-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
                  placeholder="https://example.com/username"
                />
              </div>
            </div>
            
            <div class="form-group">
              <label class="block text-sm font-medium text-gray-700 mb-2">–û–ø–∏—Å–∞–Ω–∏–µ</label>
              <input 
                v-model="socialMedia.description" 
                type="text" 
                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
                placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ"
              />
            </div>
          </div>
        </div>
        
        <div class="bg-white rounded-xl shadow-sm overflow-hidden">
          <div class="p-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-6">–ú–µ—Ç–æ–¥ –æ–ø–ª–∞—Ç—ã</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-4">
              <div class="form-group">
                <label class="block text-sm font-medium text-gray-700 mb-2">–¢–∏–ø –º–µ—Ç–æ–¥–∞</label>
                <div class="relative">
                  <select 
                    v-model="paymentMethod.type" 
                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all appearance-none pr-10"
                  >
                    <option value="" disabled>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –º–µ—Ç–æ–¥–∞</option>
                    <option value="bank_card">–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞</option>
                    <option value="crypto">–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞</option>
                    <option value="paypal">PayPal</option>
                    <option value="other">–î—Ä—É–≥–æ–µ</option>
                  </select>
                  <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                    <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                  </div>
                </div>
              </div>
              
              <div class="form-group">
                <label class="block text-sm font-medium text-gray-700 mb-2">–ó–Ω–∞—á–µ–Ω–∏–µ</label>
                <input 
                  v-model="paymentMethod.value" 
                  type="text" 
                  class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
                  placeholder="–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã, –∞–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞ –∏ —Ç.–¥."
                />
              </div>
            </div>
            
            <div class="form-group">
              <label class="block text-sm font-medium text-gray-700 mb-2">–û–ø–∏—Å–∞–Ω–∏–µ</label>
              <input 
                v-model="paymentMethod.description" 
                type="text" 
                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
                placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ"
              />
            </div>
          </div>
        </div>
        
        <div class="flex justify-between">
          <button 
            @click="prevStep" 
            class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all duration-200 flex items-center"
          >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M7.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l2.293 2.293a1 1 0 010 1.414z" clip-rule="evenodd" />
            </svg>
            –ù–∞–∑–∞–¥
          </button>
          <button 
            @click="createPlayer" 
            class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-all duration-200 flex items-center"
          >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
            </svg>
            –°–æ–∑–¥–∞—Ç—å –∏–≥—Ä–æ–∫–∞
          </button>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue';
import { useRouter } from 'vue-router';
import { usePlayerStore } from '@/stores/player';
import type { 
  CreatePlayerRequest, 
  PlayerNickname,
  PlayerContact,
  PlayerLocation,
  PlayerSocialMedia,
  PlayerPaymentMethod
} from '@/types/models';

const router = useRouter();
const playerStore = usePlayerStore();

// –ü–æ—à–∞–≥–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
const currentStep = ref(1);
const totalSteps = 4;
const steps = [
  { id: 1, title: '–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è' },
  { id: 2, title: '–ö–æ–Ω—Ç–∞–∫—Ç—ã' },
  { id: 3, title: '–ê–¥—Ä–µ—Å' },
  { id: 4, title: '–°–æ—Ü—Å–µ—Ç–∏ –∏ –æ–ø–ª–∞—Ç–∞' }
];

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ —à–∞–≥–∞–º
const nextStep = () => {
  if (currentStep.value < totalSteps) {
    currentStep.value++;
  }
};

const prevStep = () => {
  if (currentStep.value > 1) {
    currentStep.value--;
  }
};

// –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏–≥—Ä–æ–∫–∞
const player = ref({
  first_name: '',
  last_name: '',
  middle_name: '',
  health_notes: ''
});

// –ù–∏–∫–Ω–µ–π–º
const nickname = ref<Partial<PlayerNickname>>({
  nickname: '',
  room: '',
  discipline: ''
});

// Email –∫–æ–Ω—Ç–∞–∫—Ç
const email = ref('');

// –¢–µ–ª–µ—Ñ–æ–Ω
const phone = ref<Partial<PlayerContact>>({
  type: 'phone',
  value: '',
  description: ''
});

// –ê–¥—Ä–µ—Å
const location = ref<Partial<PlayerLocation>>({
  address: '',
  city: '',
  country: '',
  postal_code: ''
});

// –°–æ—Ü–∏–∞–ª—å–Ω–∞—è —Å–µ—Ç—å
const socialMedia = ref<Partial<PlayerSocialMedia>>({
  platform: '',
  username: '',
  url: '',
  description: ''
});

// –ú–µ—Ç–æ–¥ –æ–ø–ª–∞—Ç—ã
const paymentMethod = ref<Partial<PlayerPaymentMethod>>({
  type: '',
  value: '',
  description: ''
});

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–≥—Ä–æ–∫–∞
const createPlayer = async () => {
  try {
    // –§–æ—Ä–º–∏—Ä—É–µ–º –æ–±—ä–µ–∫—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
    const playerData: CreatePlayerRequest = {
      ...player.value,
      nicknames: nickname.value.nickname ? [nickname.value] : [],
      contacts: [],
      locations: [],
      social_media: [],
      payment_methods: []
    };
    
    // –î–æ–±–∞–≤–ª—è–µ–º email, –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω
    if (email.value) {
      playerData.contacts?.push({
        type: 'email',
        value: email.value
      });
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–ª–µ—Ñ–æ–Ω, –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω
    if (phone.value.value) {
      playerData.contacts?.push({
        type: 'phone',
        value: phone.value.value,
        description: phone.value.description
      });
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∞–¥—Ä–µ—Å, –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω
    if (location.value.address || location.value.city) {
      playerData.locations?.push(location.value);
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ—Ü–∏–∞–ª—å–Ω—É—é —Å–µ—Ç—å, –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–∞
    if (socialMedia.value.platform && (socialMedia.value.username || socialMedia.value.url)) {
      playerData.social_media?.push(socialMedia.value);
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–æ–¥ –æ–ø–ª–∞—Ç—ã, –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω
    if (paymentMethod.value.type && paymentMethod.value.value) {
      playerData.payment_methods?.push(paymentMethod.value);
    }
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
    const createdPlayer = await playerStore.createPlayer(playerData);
    
    if (createdPlayer && createdPlayer.id) {
      // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞
      router.push(`/players/${createdPlayer.id}`);
    } else {
      throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –∏–≥—Ä–æ–∫–∞');
    }
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏–≥—Ä–æ–∫–∞:', error);
    alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏–≥—Ä–æ–∫–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
  }
};
</script>

<style scoped>
.hide-scrollbar::-webkit-scrollbar {
  display: none;
}
.hide-scrollbar {
  -ms-overflow-style: none;
  scrollbar-width: none;
}
</style> 