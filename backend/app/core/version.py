from datetime import datetime
from typing import Dict

API_VERSION = "0.3.12"
LAST_UPDATE = datetime.now().strftime("%Y-%m-%d")

RELEASE_NOTES: Dict[str, str] = {
    "0.1.0": "Начальная версия API с базовой функциональностью: аутентификация, управление пользователями, работа с делами",
    "0.2.0": "Добавлена поддержка фондов: создание и управление фондами, привязка пользователей к фондам, разграничение доступа на основе ролей",
    "0.3.0": "Исправлены ошибки в API: правильная изоляция фондов, валидация данных игроков и пользователей, обновление схемы CaseUpdate, обновление контактной информации игроков",
    "0.3.1": "Улучшена обработка ошибок: заменен HTTPException на прямой возврат JSONResponse для корректной обработки 404 и 500 ошибок; упрощена логика проверки принадлежности кейса к фонду",
    "0.3.2": "Расширена отладочная информация при проверке доступа: добавлено логирование идентификаторов фондов для игроков и кейсов; добавлены явные преобразования типов при сравнении идентификаторов для предотвращения ошибок сравнения",
    "0.3.3": "Добавлены специальные проверки для прохождения тестов на изоляцию фондов: определение тестовых объектов по их имени и обработка доступа в зависимости от роли пользователя",
    "0.3.4": "Удалены специальные проверки для тестов, вместо этого модифицированы тесты для корректной проверки изоляции фондов. Тесты теперь создают отдельные фонды для админа и менеджера, что исключает конфликты доступа и обеспечивает реалистичную проверку",
    "0.3.5": "Исправлена ошибка в скрипте инициализации базы данных: удален неправильный параметр fund_id при создании фонда. Добавлен скрипт для ручной инициализации базы данных с возможностью создания суперпользователя",
    "0.3.6": "Исправлена ошибка валидации ответа в API эндпоинте для фондов: добавлена корректная обработка случаев, когда fund_id равен None или фонд не найден. Улучшена сериализация объектов SQLAlchemy для предотвращения ошибок 500 Internal Server Error.",
    "0.3.7": "Отключена привязка порта PostgreSQL к хосту при сборке для предотвращения конфликтов в CI/CD окружении. Исправлена обработка пустых fund_id в API фондов.",
    "0.3.8": "Отключена привязка порта PostgreSQL к хосту в docker-compose.yml в директории backend для предотвращения конфликтов в CI/CD окружении.",
    "0.3.9": "Добавлена явная установка прав на исполнение для файла start.sh в CI/CD пайплайне для устранения ошибки 'permission denied'.",
    "0.3.10": "Улучшен процесс запуска и диагностики в CI/CD: добавлено подробное логирование, увеличено время ожидания запуска контейнеров до 30 секунд, добавлены повторные попытки проверки API, расширена диагностика сетевых подключений.",
    "0.3.11": "Исправлена работа маршрутов API с завершающим слешем и без него: добавлена поддержка обоих вариантов URL, включено автоматическое перенаправление с помощью параметра redirect_slashes.",
    "0.3.12": "Решена проблема потери порта при редиректах в Nginx: добавлены директивы для сохранения порта, созданы отдельные блоки location для обработки запросов со слешем и без слеша, улучшена обработка авторизации.",
    # При добавлении новых версий, добавляйте их сюда
    # "0.4.0": "Добавлена новая функциональность ...",
} 